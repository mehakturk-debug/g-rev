<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TaskFlow Pro v4 - Enterprise</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary: #6366f1; --bg: #0f172a; --card: #1e293b;
            --text: #f8fafc; --muted: #94a3b8; --danger: #ef4444; --wa: #25d366;
        }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 10px; }
        .container { max-width: 1000px; margin: 0 auto; }
        
        /* Modern Glass UI */
        .glass-card { background: var(--card); border-radius: 16px; padding: 20px; border: 1px solid rgba(255,255,255,0.1); margin-bottom: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.3); }
        h3 { margin: 0 0 15px 0; font-size: 1rem; color: var(--primary); display: flex; align-items: center; gap: 8px; }
        
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 12px; }
        .full-width { grid-column: 1 / -1; }
        
        label { display: block; font-size: 11px; text-transform: uppercase; color: var(--muted); margin-bottom: 4px; font-weight: 700; }
        input, select, button { 
            width: 100%; padding: 12px; background: #334155; border: 1px solid #475569; 
            color: white; border-radius: 10px; font-size: 15px; outline: none; box-sizing: border-box;
        }
        input:focus { border-color: var(--primary); }
        
        button { background: var(--primary); cursor: pointer; border: none; font-weight: 700; transition: 0.2s; }
        button:hover { filter: brightness(1.1); transform: translateY(-1px); }
        
        /* Task Display */
        .task-card { background: var(--card); border-radius: 12px; padding: 15px; margin-bottom: 12px; border-left: 5px solid var(--primary); }
        .prio-Acil { border-left-color: var(--danger); }
        .task-header { display: flex; justify-content: space-between; align-items: flex-start; }
        .meta { display: flex; flex-wrap: wrap; gap: 12px; font-size: 12px; color: var(--muted); margin-top: 10px; }
        .wa-btn { background: var(--wa); color: white; margin-top: 10px; padding: 10px; font-size: 14px; }
        
        .management-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        @media (max-width: 650px) { .management-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div class="container">
    <header style="text-align:center; padding: 20px 0;">
        <h1 style="margin:0; letter-spacing: -1px;">TaskFlow <span style="color:var(--primary)">Pro</span></h1>
        <small id="sync" style="color:var(--wa)">‚óè BULUT SENKRONƒ∞ZASYONU AKTƒ∞F</small>
    </header>

    <div class="management-grid">
        <div class="glass-card">
            <h3><i class="fas fa-folder-plus"></i> Kategori Y√∂netimi</h3>
            <div style="display: flex; gap: 8px;">
                <input type="text" id="newCat" placeholder="√ñrn: Yazƒ±lƒ±m">
                <button onclick="app.addCat()" style="width: 60px;">+</button>
            </div>
        </div>
        <div class="glass-card">
            <h3><i class="fas fa-user-plus"></i> Personel Kaydƒ±</h3>
            <div style="display: flex; flex-direction: column; gap: 8px;">
                <input type="text" id="newName" placeholder="Ad Soyad">
                <input type="tel" id="newPhone" placeholder="905xxxxxxxxx">
                <button onclick="app.addPerson()">Kaydet</button>
            </div>
        </div>
    </div>

    <div class="glass-card">
        <h3><i class="fas fa-rocket"></i> G√∂rev Daƒüƒ±tƒ±m Paneli</h3>
        <div class="form-grid">
            <div><label>Kategori</label><select id="selCat"></select></div>
            <div><label>Sorumlu Personel</label><select id="selPerson"></select></div>
            <div><label>Aciliyet</label>
                <select id="selPrio">
                    <option value="Normal">Normal</option>
                    <option value="Acil">Acil (Y√ºksek)</option>
                </select>
            </div>
            <div class="full-width"><label>ƒ∞≈üin Detayƒ±</label><input type="text" id="jobDesc" placeholder="Yapƒ±lacak i≈üi buraya yazƒ±n..."></div>
            <div><label>Ba≈ülangƒ±√ß Tarihi</label><input type="datetime-local" id="jobStart"></div>
            <div><label>Biti≈ü Tarihi</label><input type="datetime-local" id="jobEnd"></div>
            <div style="display: flex; align-items: flex-end;">
                <button onclick="app.addTask()" style="height: 45px;">G√∂revi Atla</button>
            </div>
        </div>
    </div>

    <div id="taskList"></div>
</div>

<script>
// --- KONFƒ∞G√úRASYON (SENƒ∞N Bƒ∞LGƒ∞LERƒ∞N) ---
const firebaseConfig = {
    apiKey: "AIzaSyBUF3LdVqpHkC5Ha2YReluEY5cbe9ScKhg",
    authDomain: "is-takip-sistemi-94c21.firebaseapp.com",
    projectId: "is-takip-sistemi-94c21",
    storageBucket: "is-takip-sistemi-94c21.firebasestorage.app",
    messagingSenderId: "113312619940",
    appId: "1:113312619940:web:59e4daaec3d9e8800a3531",
    measurementId: "G-F0G7XM60S6",
    databaseURL: "https://is-takip-sistemi-94c21-default-rtdb.europe-west1.firebasedatabase.app"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const app = {
    init() {
        // Kategorileri Dinle
        db.ref('categories').on('value', snap => {
            const data = snap.val();
            const list = Array.isArray(data) ? data : (data ? Object.values(data) : ["Genel"]);
            document.getElementById('selCat').innerHTML = list.map(c => `<option value="${c}">${c}</option>`).join('');
        });

        // Ki≈üileri Dinle
        db.ref('people').on('value', snap => {
            const data = snap.val();
            const el = document.getElementById('selPerson');
            if(!data) { el.innerHTML = '<option value="">√ñnce Personel Ekleyin</option>'; return; }
            el.innerHTML = Object.keys(data).map(k => `<option value="${k}">${data[k].name}</option>`).join('');
        });

        // G√∂revleri Dinle
        db.ref('tasks').on('value', snap => this.render(snap.val()));
    },

    addCat() {
        const val = document.getElementById('newCat').value.trim();
        if(!val) return;
        db.ref('categories').once('value', snap => {
            let cats = snap.val();
            if(!Array.isArray(cats)) cats = cats ? Object.values(cats) : [];
            if(!cats.includes(val)) {
                cats.push(val);
                db.ref('categories').set(cats);
            }
        });
        document.getElementById('newCat').value = '';
    },

    addPerson() {
        const name = document.getElementById('newName').value.trim();
        const phone = document.getElementById('newPhone').value.trim();
        if(!name || !phone) return alert("ƒ∞sim ve telefon bo≈ü bƒ±rakƒ±lamaz!");
        db.ref('people').push({ name, phone });
        document.getElementById('newName').value = '';
        document.getElementById('newPhone').value = '';
    },

    addTask() {
        const pKey = document.getElementById('selPerson').value;
        if(!pKey) return alert("L√ºtfen √∂nce bir personel se√ßin!");

        db.ref('people/' + pKey).once('value', snap => {
            const p = snap.val();
            const task = {
                desc: document.getElementById('jobDesc').value,
                cat: document.getElementById('selCat').value,
                prio: document.getElementById('selPrio').value,
                start: document.getElementById('jobStart').value,
                end: document.getElementById('jobEnd').value,
                uName: p.name,
                uPhone: p.phone,
                at: Date.now()
            };
            if(!task.desc || !task.end) return alert("ƒ∞≈ü detayƒ± ve biti≈ü tarihi zorunludur!");
            
            db.ref('tasks').push(task).then(() => {
                this.sendWA(task);
                document.getElementById('jobDesc').value = '';
            });
        });
    },

    sendWA(t) {
        const msg = `üöÄ *YENƒ∞ G√ñREV ATAMASI*%0A%0A*ƒ∞≈ü:* ${t.desc}%0A*Kategori:* ${t.cat}%0A*Biti≈ü:* ${t.end.replace('T',' ')}%0A*√ñnem:* ${t.prio}`;
        window.open(`https://wa.me/${t.uPhone}?text=${msg}`, '_blank');
    },

    render(data) {
        const container = document.getElementById('taskList');
        if(!data) { container.innerHTML = '<p style="text-align:center; color:gray;">Hen√ºz g√∂rev atanmamƒ±≈ü.</p>'; return; }
        
        container.innerHTML = Object.keys(data).reverse().map(k => {
            const t = data[k];
            return `
                <div class="task-card prio-${t.prio}">
                    <div class="task-header">
                        <div>
                            <span style="font-size:10px; background:#334155; padding:2px 6px; border-radius:4px;">${t.cat}</span>
                            <h4 style="margin:8px 0;">${t.desc}</h4>
                        </div>
                        <button onclick="db.ref('tasks/${k}').remove()" style="width:auto; background:none; color:var(--danger); font-size:18px;"><i class="fas fa-times-circle"></i></button>
                    </div>
                    <div class="meta">
                        <span><i class="fas fa-user"></i> ${t.uName}</span>
                        <span><i class="fas fa-calendar-alt"></i> ${t.end.replace('T', ' ')}</span>
                        <span style="color:${t.prio === 'Acil' ? 'var(--danger)' : 'var(--wa)'}">‚óè ${t.prio}</span>
                    </div>
                    <button class="wa-btn" onclick="app.sendWA(${JSON.stringify(t).replace(/"/g, '&quot;')})">
                        <i class="fab fa-whatsapp"></i> Hatƒ±rlatƒ±cƒ± G√∂nder
                    </button>
                </div>
            `;
        }).join('');
    }
};

app.init();
</script>
</body>
</html>
