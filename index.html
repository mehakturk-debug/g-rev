<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enterprise Task Manager</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #6366f1; --primary-hover: #4f46e5;
            --bg: #0f172a; --card-bg: #1e293b;
            --text: #f8fafc; --text-muted: #94a3b8;
            --danger: #ef4444; --success: #22c55e;
        }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 10px; }
        .container { max-width: 1000px; margin: 0 auto; }
        
        /* Modern UI Components */
        .glass-card { background: var(--card-bg); border-radius: 16px; padding: 20px; border: 1px solid rgba(255,255,255,0.1); margin-bottom: 20px; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.5); }
        h3 { margin-top: 0; font-size: 1.1rem; display: flex; align-items: center; gap: 10px; color: var(--primary); }
        
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        input, select, button { 
            background: #334155; border: 1px solid #475569; color: white; padding: 12px; border-radius: 10px; font-size: 14px; outline: none; transition: 0.3s;
        }
        input:focus { border-color: var(--primary); box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2); }
        button { background: var(--primary); cursor: pointer; border: none; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 8px; }
        button:hover { background: var(--primary-hover); }
        button.wa { background: #25d366; color: white; }

        /* Task Item Style */
        .task-card { 
            background: #1e293b; border-radius: 12px; padding: 16px; margin-bottom: 12px; 
            border-left: 5px solid var(--primary); display: flex; flex-direction: column; gap: 10px;
            transition: transform 0.2s;
        }
        .task-header { display: flex; justify-content: space-between; align-items: flex-start; }
        .task-meta { display: flex; flex-wrap: wrap; gap: 10px; font-size: 12px; color: var(--text-muted); }
        .prio-high { border-left-color: var(--danger); }
        
        .management-section { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        @media (max-width: 600px) { .management-section { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div class="container">
    <div style="text-align: center; padding: 20px;">
        <h1 style="margin:0; background: linear-gradient(to right, #818cf8, #c084fc); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">TaskFlow Pro</h1>
        <p style="color: var(--text-muted); font-size: 14px;">Merkezi ƒ∞≈ü Takip & Senkronizasyon</p>
    </div>

    <div class="management-section">
        <div class="glass-card">
            <h3><i class="fas fa-tags"></i> Kategori Ekle</h3>
            <div style="display: flex; gap: 10px;">
                <input type="text" id="catInput" placeholder="Kategori adƒ±...">
                <button onclick="manager.add('categories', 'catInput')">+</button>
            </div>
        </div>
        <div class="glass-card">
            <h3><i class="fas fa-users"></i> Ki≈üi Ekle</h3>
            <div style="display: flex; flex-direction: column; gap: 8px;">
                <input type="text" id="perName" placeholder="Ad Soyad">
                <input type="tel" id="perPhone" placeholder="905xxxxxxxxx">
                <button onclick="manager.addPerson()">Ki≈üi Ekle</button>
            </div>
        </div>
    </div>

    <div class="glass-card">
        <h3><i class="fas fa-plus-circle"></i> Yeni G√∂rev Atama</h3>
        <div class="form-grid">
            <div><label>Kategori</label><select id="taskCat"></select></div>
            <div><label>Sorumlu Ki≈üi</label><select id="taskPerson"></select></div>
            <div><label>ƒ∞≈ü Tanƒ±mƒ±</label><input type="text" id="taskName"></div>
            <div><label>Aciliyet</label>
                <select id="taskPrio">
                    <option value="Normal">Normal</option>
                    <option value="Acil">Y√ºksek (Acil)</option>
                </select>
            </div>
            <div><label>Ba≈ülangƒ±√ß</label><input type="datetime-local" id="taskStart"></div>
            <div><label>Biti≈ü</label><input type="datetime-local" id="taskEnd"></div>
            <div style="display: flex; align-items: flex-end;">
                <button onclick="manager.addTask()" style="width: 100%;">G√∂revi Tanƒ±mla & Senkronize Et</button>
            </div>
        </div>
    </div>

    <div id="taskList"></div>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBUF3LdVqpHkC5Ha2YReluEY5cbe9ScKhg",
  authDomain: "is-takip-sistemi-94c21.firebaseapp.com",
  projectId: "is-takip-sistemi-94c21",
  storageBucket: "is-takip-sistemi-94c21.firebasestorage.app",
  messagingSenderId: "113312619940",
  appId: "1:113312619940:web:59e4daaec3d9e8800a3531",
  databaseURL: "https://is-takip-sistemi-94c21-default-rtdb.firebaseio.com"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const manager = {
    // Veritabanƒ± Dinleyicileri
    init() {
        db.ref('categories').on('value', s => this.populateSelect('taskCat', s.val() || ["Genel"]));
        db.ref('people').on('value', s => this.populatePeople(s.val()));
        db.ref('tasks').on('value', s => this.renderTasks(s.val()));
    },

    add(path, inputId) {
        const val = document.getElementById(inputId).value;
        if(!val) return;
        db.ref(path).once('value', s => {
            const data = s.val() || [];
            data.push(val);
            db.ref(path).set(data);
        });
        document.getElementById(inputId).value = '';
    },

    addPerson() {
        const name = document.getElementById('perName').value;
        const phone = document.getElementById('perPhone').value;
        if(!name || !phone) return alert("ƒ∞sim ve Telefon ≈üart!");
        db.ref('people').push({ name, phone });
        document.getElementById('perName').value = '';
        document.getElementById('perPhone').value = '';
    },

    addTask() {
        const personKey = document.getElementById('taskPerson').value;
        db.ref('people/' + personKey).once('value', s => {
            const person = s.val();
            const task = {
                name: document.getElementById('taskName').value,
                cat: document.getElementById('taskCat').value,
                prio: document.getElementById('taskPrio').value,
                start: document.getElementById('taskStart').value,
                end: document.getElementById('taskEnd').value,
                who: person.name,
                phone: person.phone,
                ts: Date.now()
            };
            
            db.ref('tasks').push(task).then(() => {
                this.sendWhatsApp(task);
                alert("G√∂rev kaydedildi ve WhatsApp tetiklendi!");
            });
        });
    },

    sendWhatsApp(t) {
        const msg = `üöÄ *YENƒ∞ G√ñREV ATANDI*%0A%0A*ƒ∞≈ü:* ${t.name}%0A*Kategori:* ${t.cat}%0A*Biti≈ü:* ${t.end.replace('T',' ')}%0A*Aciliyet:* ${t.prio}%0A%0AKolay gelsin!`;
        window.open(`https://wa.me/${t.phone}?text=${msg}`, '_blank');
    },

    populateSelect(id, data) {
        const el = document.getElementById(id);
        el.innerHTML = Object.values(data).map(v => `<option value="${v}">${v}</option>`).join('');
    },

    populatePeople(data) {
        const el = document.getElementById('taskPerson');
        if(!data) return;
        el.innerHTML = Object.keys(data).map(k => `<option value="${k}">${data[k].name}</option>`).join('');
    },

    renderTasks(data) {
        const container = document.getElementById('taskList');
        if(!data) { container.innerHTML = ""; return; }
        
        container.innerHTML = Object.keys(data).reverse().map(k => {
            const t = data[k];
            return `
                <div class="task-card ${t.prio === 'Acil' ? 'prio-high' : ''}">
                    <div class="task-header">
                        <div>
                            <span class="badge" style="background:var(--primary); padding:2px 8px; border-radius:5px; font-size:10px;">${t.cat}</span>
                            <h4 style="margin:5px 0;">${t.name}</h4>
                        </div>
                        <button onclick="db.ref('tasks/${k}').remove()" class="btn-delete" style="background:transparent; color:var(--danger)"><i class="fas fa-trash"></i></button>
                    </div>
                    <div class="task-meta">
                        <span><i class="far fa-clock"></i> ${t.start.replace('T',' ')} / ${t.end.replace('T',' ')}</span>
                        <span><i class="far fa-user"></i> ${t.who}</span>
                        <span style="color:${t.prio === 'Acil' ? 'var(--danger)' : 'var(--success)'}">‚óè ${t.prio}</span>
                    </div>
                    <button class="wa" onclick="manager.sendWhatsApp(${JSON.stringify(t).replace(/"/g, '&quot;')})">
                        <i class="fab fa-whatsapp"></i> Yeniden Hatƒ±rlat
                    </button>
                </div>
            `;
        }).join('');
    }
};

manager.init();
</script>
</body>
</html>
